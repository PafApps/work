<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивен списък на AutoLISP команди</title>
    <style>
        /* ... Всички предишни стилове са тук ... */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 25px 35px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; }
        h1 { text-align: center; color: #1d3557; border-bottom: 2px solid #457b9d; padding-bottom: 10px; margin-bottom: 30px; }
        h2 { color: #457b9d; margin-top: 40px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid #a8dadc; }
        
        /* Стилове за бутоните горе вдясно */
        .header-buttons { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .header-btn { background-color: #e63946; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .header-btn:hover { background-color: #a8202b; }
        #suggestion-count { background-color: white; color: #e63946; border-radius: 50%; padding: 0px 6px; font-size: 12px; margin-left: 5px; }

        /* Стилове за модалните прозорци */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; }

        /* Стилове за формата */
        #suggestion-form label { display: block; margin-top: 10px; font-weight: bold; }
        #suggestion-form input[type="text"], #suggestion-form textarea { width: 95%; padding: 10px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
        #suggestion-form textarea { height: 100px; resize: vertical; }
        #suggestion-form button { background-color: #457b9d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; font-size: 16px; }
        
        /* Стилове за списъка с предложения */
        #suggestions-list .suggestion-item { border-bottom: 1px solid #eee; padding: 15px 5px; display: flex; justify-content: space-between; align-items: flex-start; }
        #suggestions-list .suggestion-details { flex-grow: 1; }
        #suggestions-list .suggester-name { font-weight: bold; color: #1d3557; }
        #suggestions-list .suggestion-text { margin-top: 5px; }
        #suggestions-list .status-toggle { cursor: pointer; border: none; background: none; font-size: 16px; padding: 5px 10px; border-radius: 5px; transition: background-color 0.3s; min-width: 150px; text-align: left; }
        #suggestions-list .status-toggle.is-pending { background-color: #fce8e6; color: #a50e0e; }
        #suggestions-list .status-toggle.is-done { background-color: #e6f4ea; color: #137333; }
        
        /* ... Останалите стилове от предишния код ... */
        #alphabet-filter { display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e1e1e1; }
        .filter-button { background-color: #a8dadc; color: #1d3557; border: none; border-radius: 4px; padding: 5px 10px; font-size: 14px; font-weight: bold; cursor: pointer; transition: background-color 0.3s, color 0.3s; }
        .filter-button:hover, .filter-button.active { background-color: #1d3557; color: white; }
        .category.hidden, .command-entry.hidden { display: none; }
        .command-entry { margin-bottom: 8px; border-radius: 6px; overflow: hidden; border: 1px solid #e1e1e1; transition: opacity 0.5s, transform 0.5s; }
        .command-header { display: flex; align-items: center; background-color: #f8f9fa; padding: 5px 10px; cursor: pointer; }
        .command-button { background-color: #457b9d; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 15px; transition: background-color 0.3s; text-align: center; font-weight: 500; min-width: 200px; text-transform: uppercase; }
        .command-header:hover .command-button, .command-button.active { background-color: #1d3557; }
        .short-description { margin-left: 15px; font-size: 15px; color: #555; flex-grow: 1; }
        .full-description-panel { max-height: 0; opacity: 0; overflow: hidden; background-color: #f1faee; color: #1d3557; box-sizing: border-box; transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.4s ease-out; padding: 0 15px; }
        .full-description-panel.show { max-height: 200px; opacity: 1; padding: 15px; transition: max-height 0.4s ease-in, opacity 0.3s ease-in, padding 0.4s ease-in; }
        .full-description-panel p { margin: 0; font-size: 14px; }
        .alias-note { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .alias-button { background-color: #e63946; }
        .alias-button:hover, .alias-button.active { background-color: #a8202b; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-buttons">
            <button id="add-suggestion-btn" class="header-btn">Предложение</button>
            <button id="view-suggestions-btn" class="header-btn">
                Виж предложенията
                <span id="suggestion-count">0</span>
            </button>
        </div>

        <h1>Интерактивен списък на AutoLISP команди</h1>

        <!-- ... целия HTML код с филтъра и категориите идва тук ... -->
        <div id="alphabet-filter">
            <!-- Бутони от A до Z -->
            <button class="filter-button active" data-filter="all">ВСИЧКИ</button>
            <script>document.write(Array.from(Array(26)).map((e, i) => `<button class="filter-button" data-filter="${String.fromCharCode(i + 65)}">${String.fromCharCode(i + 65)}</button>`).join(''));</script>
        </div>

        <div class="category" data-category="main-interface">
            <h2>Основен интерфейс</h2>
            <div class="command-entry" data-letter="P"><div class="command-header"><button class="command-button">PPS</button><span class="short-description">Основен диалогов прозорец.</span></div><div class="full-description-panel"><p>Извиква главния диалогов прозорец 'PAF Page Setups' (PPS), който служи като централен хъб за достъп до повечето други команди.</p></div></div>
        </div>

        <!-- ... и така нататък за всички останали категории и команди, точно както в предишния отговор ... -->

    </div>

    <!-- Модален прозорец за добавяне на предложение -->
    <div id="suggestion-form-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Направи предложение</h2>
            <form id="suggestion-form">
                <label for="suggester-name">Име:</label>
                <input type="text" id="suggester-name" required>
                <label for="suggestion-text">Предложение:</label>
                <textarea id="suggestion-text" required></textarea>
                <button type="submit">Изпрати</button>
            </form>
        </div>
    </div>

    <!-- Модален прозорец за преглед на предложенията -->
    <div id="suggestions-list-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Списък с предложения</h2>
            <div id="suggestions-list">
                <!-- Предложенията ще се зареждат тук динамично -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Елементи за управление на предложенията ---
            const addSuggestionBtn = document.getElementById('add-suggestion-btn');
            const viewSuggestionsBtn = document.getElementById('view-suggestions-btn');
            const suggestionFormModal = document.getElementById('suggestion-form-modal');
            const suggestionsListModal = document.getElementById('suggestions-list-modal');
            const suggestionForm = document.getElementById('suggestion-form');
            const suggestionsListDiv = document.getElementById('suggestions-list');
            const suggestionCountSpan = document.getElementById('suggestion-count');
            const closeButtons = document.querySelectorAll('.close-button');

            // --- Функции за работа с localStorage ---
            const getSuggestions = () => JSON.parse(localStorage.getItem('commandSuggestions') || '[]');
            const saveSuggestions = (suggestions) => localStorage.setItem('commandSuggestions', JSON.stringify(suggestions));
            
            // --- Функция за рендиране на списъка с предложения ---
            const renderSuggestions = () => {
                const suggestions = getSuggestions();
                suggestionsListDiv.innerHTML = ''; // Изчистваме списъка
                suggestionCountSpan.textContent = suggestions.length;

                if (suggestions.length === 0) {
                    suggestionsListDiv.innerHTML = '<p>Все още няма подадени предложения.</p>';
                    return;
                }

                suggestions.forEach(suggestion => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';

                    const details = document.createElement('div');
                    details.className = 'suggestion-details';
                    details.innerHTML = `
                        <p class="suggester-name">${suggestion.name}:</p>
                        <p class="suggestion-text">${suggestion.text}</p>
                    `;
                    
                    const statusBtn = document.createElement('button');
                    statusBtn.className = 'status-toggle';
                    statusBtn.dataset.id = suggestion.id;
                    if (suggestion.status === 'done') {
                        statusBtn.textContent = '✅ Направено';
                        statusBtn.classList.add('is-done');
                    } else {
                        statusBtn.textContent = '❌ Не е направено';
                        statusBtn.classList.add('is-pending');
                    }
                    
                    item.appendChild(details);
                    item.appendChild(statusBtn);
                    suggestionsListDiv.appendChild(item);
                });
            };

            // --- Управление на модалните прозорци ---
            addSuggestionBtn.addEventListener('click', () => {
                suggestionFormModal.style.display = 'block';
            });
            viewSuggestionsBtn.addEventListener('click', () => {
                renderSuggestions();
                suggestionsListModal.style.display = 'block';
            });
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    suggestionFormModal.style.display = 'none';
                    suggestionsListModal.style.display = 'none';
                });
            });
            window.addEventListener('click', (event) => {
                if (event.target == suggestionFormModal || event.target == suggestionsListModal) {
                    suggestionFormModal.style.display = 'none';
                    suggestionsListModal.style.display = 'none';
                }
            });

            // --- Логика при изпращане на формата ---
            suggestionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('suggester-name').value;
                const text = document.getElementById('suggestion-text').value;

                if (text.trim() === '') {
                    alert('Моля, въведете текст на предложението.');
                    return;
                }

                const suggestions = getSuggestions();
                const newSuggestion = {
                    id: Date.now(),
                    name: name.trim() || 'Анонимен',
                    text: text.trim(),
                    status: 'pending' // 'pending' или 'done'
                };
                suggestions.push(newSuggestion);
                saveSuggestions(suggestions);

                suggestionForm.reset();
                suggestionFormModal.style.display = 'none';
                renderSuggestions();
                alert('Благодарим за предложението!');
            });
            
            // --- Логика за промяна на статуса ---
            suggestionsListDiv.addEventListener('click', (e) => {
                if (e.target.classList.contains('status-toggle')) {
                    const id = Number(e.target.dataset.id);
                    const suggestions = getSuggestions();
                    const suggestion = suggestions.find(s => s.id === id);
                    if (suggestion) {
                        suggestion.status = suggestion.status === 'pending' ? 'done' : 'pending';
                        saveSuggestions(suggestions);
                        renderSuggestions();
                    }
                }
            });

            // --- Инициализиране при зареждане на страницата ---
            renderSuggestions();
            
            // --- Останалата част от JavaScript за филтъра и падащите панели ---
            const filterContainer = document.getElementById('alphabet-filter');
            const categories = document.querySelectorAll('.category');
            const commandEntries = document.querySelectorAll('.command-entry');
            const commandHeaders = document.querySelectorAll('.command-header');

            filterContainer.addEventListener('click', function(e) {
                const button = e.target.closest('.filter-button');
                if (!button) return;
                const filter = button.dataset.filter.toUpperCase();
                filterContainer.querySelector('.active').classList.remove('active');
                button.classList.add('active');

                commandEntries.forEach(entry => {
                    const letter = entry.dataset.letter.toUpperCase();
                    entry.classList.toggle('hidden', !(filter === 'ALL' || letter === filter));
                });
                
                categories.forEach(category => {
                    const visibleEntries = category.querySelectorAll('.command-entry:not(.hidden)');
                    category.classList.toggle('hidden', visibleEntries.length === 0);
                });
            });

            commandHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const button = this.querySelector('.command-button');
                    const currentPanel = this.nextElementSibling;
                    document.querySelectorAll('.full-description-panel.show').forEach(panel => {
                        if (panel !== currentPanel) {
                            panel.classList.remove('show');
                            panel.previousElementSibling.querySelector('.command-button').classList.remove('active');
                        }
                    });
                    currentPanel.classList.toggle('show');
                    button.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>
