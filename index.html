    <!-- Модални прозорци за предложения -->
    <div id="suggestion-form-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Направи предложение</h2>
            <form id="suggestion-form">
                <label for="suggester-name">Име:</label>
                <input type="text" id="suggester-name" required>
                <label for="suggestion-text">Предложение:</label>
                <textarea id="suggestion-text" required></textarea>
                <button type="submit">Изпрати</button>
            </form>
        </div>
    </div>
    <div id="suggestions-list-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Списък с предложения</h2>
            <div id="suggestions-list"></div>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // <<< ВАШАТА FIREBASE КОНФИГУРАЦИЯ Е ПОСТАВЕНА ТУК >>>
        const firebaseConfig = {
          apiKey: "AIzaSyACB9shT_VTr3PGW_1nFjJCGAgwSI55Omw",
          authDomain: "clickcount-a6e46.firebaseapp.com",
          databaseURL: "https://clickcount-a6e46-default-rtdb.firebaseio.com",
          projectId: "clickcount-a6e46",
          storageBucket: "clickcount-a6e46.appspot.com",
          messagingSenderId: "53304151952",
          appId: "1:53304151952:web:ed0c365ace6b1232842d15",
          measurementId: "G-5S028177MG"
        };

        // Инициализация на Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const suggestionsRef = db.ref("suggestions");

        document.addEventListener('DOMContentLoaded', function() {
            // --- Функция за проверка на администраторски права ---
            const isAdmin = () => {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('admin') === 'true';
            };
            const adminMode = isAdmin();

            // Елементи за предложения
            const addSuggestionBtn = document.getElementById('add-suggestion-btn');
            const viewSuggestionsBtn = document.getElementById('view-suggestions-btn');
            const suggestionFormModal = document.getElementById('suggestion-form-modal');
            const suggestionsListModal = document.getElementById('suggestions-list-modal');
            const suggestionForm = document.getElementById('suggestion-form');
            const suggestionsListDiv = document.getElementById('suggestions-list');
            const suggestionCountSpan = document.getElementById('suggestion-count');
            const closeButtons = document.querySelectorAll('.close-button');

            const renderSuggestions = (snapshot) => {
                suggestionsListDiv.innerHTML = '';
                suggestionCountSpan.textContent = snapshot.numChildren();
                if (!snapshot.exists()) {
                    suggestionsListDiv.innerHTML = '<p>Все още няма подадени предложения.</p>';
                    return;
                }
                snapshot.forEach(childSnapshot => {
                    const key = childSnapshot.key;
                    const suggestion = childSnapshot.val();
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    
                    const statusBtn = document.createElement('button');
                    statusBtn.className = 'status-toggle';
                    statusBtn.dataset.id = key;
                    if (suggestion.status === 'done') {
                        statusBtn.textContent = '✅ Направено';
                        statusBtn.classList.add('is-done');
                    } else {
                        statusBtn.textContent = '❌ Не е направено';
                        statusBtn.classList.add('is-pending');
                    }
                    if (adminMode) {
                        statusBtn.classList.add('admin-enabled');
                    }
                    
                    item.innerHTML = `
                        <div class="suggestion-details">
                            <p class="suggester-name">${suggestion.name || 'Анонимен'}:</p>
                            <p class="suggestion-text">${suggestion.text}</p>
                        </div>`;
                    item.appendChild(statusBtn);
                    suggestionsListDiv.appendChild(item);
                });
            };

            // Слушател за промени в базата данни
            suggestionsRef.orderByChild("timestamp").on("value", renderSuggestions);

            // Управление на модални прозорци
            addSuggestionBtn.addEventListener('click', () => { suggestionFormModal.style.display = 'block'; });
            viewSuggestionsBtn.addEventListener('click', () => { suggestionsListModal.style.display = 'block'; });
            closeButtons.forEach(btn => btn.addEventListener('click', () => {
                suggestionFormModal.style.display = 'none';
                suggestionsListModal.style.display = 'none';
            }));
            window.addEventListener('click', (event) => {
                if (event.target == suggestionFormModal || event.target == suggestionsListModal) {
                    suggestionFormModal.style.display = 'none';
                    suggestionsListModal.style.display = 'none';
                }
            });

            // Форма за предложения
            suggestionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('suggester-name').value;
                const text = document.getElementById('suggestion-text').value;
                if (!text.trim()) { alert('Моля, въведете текст на предложението.'); return; }
                
                suggestionsRef.push({
                    name: name.trim() || 'Анонимен',
                    text: text.trim(),
                    status: 'pending',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    suggestionForm.reset();
                    suggestionFormModal.style.display = 'none';
                    alert('Благодарим за предложението!');
                }).catch((error) => console.error("Грешка при запис: ", error));
            });
            
            // Промяна на статус
            suggestionsListDiv.addEventListener('click', (e) => {
                if (e.target.classList.contains('status-toggle') && adminMode) {
                    const id = e.target.dataset.id;
                    const docRef = suggestionsRef.child(id);
                    docRef.get().then((snapshot) => {
                        if (snapshot.exists()) {
                            const newStatus = snapshot.val().status === 'pending' ? 'done' : 'pending';
                            docRef.update({ status: newStatus });
                        }
                    });
                }
            });

            // --- НОВА И ПОДОБРЕНА ЛОГИКА ЗА ФИЛТРИ ---
            const alphabetFilter = document.getElementById('alphabet-filter');
            const categoryFilter = document.getElementById('category-filter');
            const categories = document.querySelectorAll('.category');
            const commandEntries = document.querySelectorAll('.command-entry');
            const commandHeaders = document.querySelectorAll('.command-header');

            let currentAlphabetFilter = 'all';
            let currentCategoryFilter = 'all';

            const applyFilters = () => {
                // Първо филтрираме по категория
                categories.forEach(category => {
                    const categoryName = category.dataset.category;
                    const categoryMatch = (currentCategoryFilter === 'all' || categoryName === currentCategoryFilter);
                    category.classList.toggle('hidden', !categoryMatch);
                });

                // След това филтрираме по буква само видимите команди
                commandEntries.forEach(entry => {
                    // Проверяваме дали родителската категория на командата е видима
                    const parentCategory = entry.closest('.category');
                    if (parentCategory.classList.contains('hidden')) {
                        // Ако категорията е скрита, скриваме и командата
                        entry.classList.add('hidden');
                        return; // Преминаваме към следващата команда
                    }

                    const letter = entry.dataset.letter.toUpperCase();
                    const letterMatch = (currentAlphabetFilter === 'all' || letter === currentAlphabetFilter);
                    
                    entry.classList.toggle('hidden', !letterMatch);
                });

                // Накрая, скриваме категориите, които са останали празни след филтъра по буква
                categories.forEach(category => {
                    if (!category.classList.contains('hidden')) {
                        const visibleEntries = category.querySelectorAll('.command-entry:not(.hidden)');
                        category.classList.toggle('hidden', visibleEntries.length === 0);
                    }
                });
            };

            alphabetFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.filter-button');
                if (!button) return;
                currentAlphabetFilter = button.dataset.filter.toUpperCase();
                alphabetFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                applyFilters();
            });
            
            categoryFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.filter-button');
                if (!button) return;
                currentCategoryFilter = button.dataset.filter;
                categoryFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                applyFilters();
            });

            commandHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const button = this.querySelector('.command-button');
                    const currentPanel = this.nextElementSibling;
                    document.querySelectorAll('.full-description-panel.show').forEach(panel => {
                        if (panel !== currentPanel) {
                            panel.classList.remove('show');
                            panel.previousElementSibling.querySelector('.command-button').classList.remove('active');
                        }
                    });
                    currentPanel.classList.toggle('show');
                    button.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>
