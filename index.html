<!DOCTYPE html>
<html lang="bg">
<head>
    <!-- Важно: Файлът трябва да бъде запазен с кодиране (Encoding) UTF-8 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пълен списък на AutoLISP команди (86) с Firebase</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; background-color: #fff; padding: 25px 35px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; }
        h1, h3 { text-align: center; color: #1d3557; border-bottom: 2px solid #457b9d; padding-bottom: 10px; margin-bottom: 30px; }
        h3 { border-bottom: none; color: #555; font-weight: normal; margin-top: -20px; }
        h2 { color: #e63946; margin-top: 40px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #f1faee; font-size: 1.6em; background-color: #f8f9fa; padding: 10px; border-radius: 5px; }
        .header-buttons { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .header-btn { background-color: #e63946; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .header-btn:hover { background-color: #a8202b; }
        #suggestion-count { background-color: white; color: #e63946; border-radius: 50%; padding: 0px 6px; font-size: 12px; margin-left: 5px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        #suggestion-form label { display: block; margin-top: 10px; font-weight: bold; }
        #suggestion-form input[type="text"], #suggestion-form textarea { width: 95%; padding: 10px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
        #suggestion-form textarea { height: 100px; resize: vertical; }
        #suggestion-form button { background-color: #457b9d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; font-size: 16px; }
        #suggestions-list .suggestion-item { border-bottom: 1px solid #eee; padding: 15px 5px; display: flex; justify-content: space-between; align-items: flex-start; }
        #suggestions-list .suggestion-details { flex-grow: 1; }
        #suggestions-list .suggester-name { font-weight: bold; color: #1d3557; }
        #suggestions-list .suggestion-text { margin-top: 5px; white-space: pre-wrap; }
        #suggestions-list .status-toggle { border: none; background: none; font-size: 16px; padding: 5px 10px; border-radius: 5px; transition: background-color 0.3s; min-width: 150px; text-align: left; }
        #suggestions-list .status-toggle.is-pending { background-color: #fce8e6; color: #a50e0e; }
        #suggestions-list .status-toggle.is-done { background-color: #e6f4ea; color: #137333; }
        #suggestions-list .status-toggle.admin-enabled { cursor: pointer; }
        #suggestions-list .status-toggle:not(.admin-enabled) { cursor: not-allowed; opacity: 0.7; }
        /* --- СТИЛОВЕ ЗА ФИЛТРИТЕ --- */
        .filters-container { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e1e1e1; }
        #category-filter, #alphabet-filter { display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; }
        .filter-button, .category-filter-button { background-color: #a8dadc; color: #1d3557; border: none; border-radius: 4px; padding: 5px 10px; font-size: 14px; font-weight: bold; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .filter-button:hover, .category-filter-button:hover { background-color: #457b9d; color: white; transform: translateY(-2px); }
        .filter-button.active, .category-filter-button.active { background-color: #1d3557; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .category.hidden, .command-entry.hidden { display: none; }
        .command-entry { margin-bottom: 8px; border-radius: 6px; overflow: hidden; border: 1px solid #e9ecef; transition: box-shadow 0.3s; }
        .command-entry:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .command-header { display: flex; align-items: center; background-color: #f8f9fa; padding: 8px 15px; cursor: pointer; }
        .command-button { background-color: #457b9d; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 15px; transition: background-color 0.3s; text-align: center; font-weight: 500; min-width: 180px; text-transform: uppercase; }
        .command-header:hover .command-button, .command-button.active { background-color: #1d3557; }
        .short-description { margin-left: 20px; font-size: 15px; color: #555; flex-grow: 1; }
        .full-description-panel { max-height: 0; opacity: 0; overflow: hidden; background-color: #f1faee; color: #1d3557; box-sizing: border-box; transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.4s ease-out; padding: 0 15px; border-top: 1px solid #e1e1e1; }
        .full-description-panel.show { max-height: 300px; opacity: 1; padding: 15px; transition: max-height 0.4s ease-in, opacity 0.3s ease-in, padding 0.4s ease-in; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-buttons">
            <button id="add-suggestion-btn" class="header-btn">Предложение</button>
            <button id="view-suggestions-btn" class="header-btn">
                Виж предложенията
                <span id="suggestion-count">0</span>
            </button>
        </div>

        <h1>Интерактивен списък на AutoLISP команди</h1>
        <h3>Намерени общо 86 уникални команди, разпределени в категории</h3>

        <!-- =========== НАЧАЛО НА ПРОМЕНИТЕ (HTML) =========== -->
        <div class="filters-container">
            <div id="category-filter">
                <button class="category-filter-button active" data-filter="all">ВСИЧКИ СЕКЦИИ</button>
                <button class="category-filter-button" data-filter="situation">Ситуация</button>
                <button class="category-filter-button" data-filter="longitudinal-profiles">Надлъжни</button>
                <button class="category-filter-button" data-filter="cross-sections">Напречни</button>
                <button class="category-filter-button" data-filter="blocks">Блокове</button>
                <button class="category-filter-button" data-filter="layouts">Layouts</button>
                <button class="category-filter-button" data-filter="civil">Civil 3D</button>
                <button class="category-filter-button" data-filter="registers">Регистри (Civil)</button>
                <button class="category-filter-button" data-filter="other">Други</button>
            </div>
            <div id="alphabet-filter">
                <button class="filter-button active" data-filter="all">ВСИЧКИ БУКВИ</button>
                <script>document.write(Array.from(Array(26)).map((e, i) => `<button class="filter-button" data-filter="${String.fromCharCode(i + 65)}">${String.fromCharCode(i + 65)}</button>`).join(''));</script>
            </div>
        </div>
        <!-- =========== КРАЙ НА ПРОМЕНИТЕ (HTML) =========== -->

        <div class="category" data-category="situation">
            <!-- Съдържанието на категориите остава непроменено -->
            <h2>Команди за Ситуация</h2>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">addtoblock</button><span class="short-description">Добавя обекти към блок.</span></div><div class="full-description-panel"><p>Вкарва маркирани обекти в съществуващ, маркиран от вас блок.</p></div></div>
            <!-- ... и т.н. за всички команди ... -->
        </div>

        <div class="category" data-category="longitudinal-profiles">
            <h2>Команди за Надлъжни профили</h2>
            <!-- ... съдържание ... -->
        </div>
        
        <div class="category" data-category="cross-sections">
            <h2>Команди за Напречни профили</h2>
            <!-- ... съдържание ... -->
        </div>
        
        <div class="category" data-category="blocks">
            <h2>Команди за Блокове</h2>
            <!-- ... съдържание ... -->
        </div>
        
        <div class="category" data-category="layouts">
            <h2>Команди за Layouts</h2>
            <!-- ... съдържание ... -->
        </div>

        <div class="category" data-category="other">
            <h2>Други команди</h2>
            <!-- ... съдържание ... -->
        </div>

        <div class="category" data-category="civil">
            <h2>Команди за Civil 3D</h2>
            <!-- ... съдържание ... -->
        </div>
        
        <div class="category" data-category="registers">
            <h2>Команди за Регистри (Civil 3D)</h2>
            <!-- ... съдържание ... -->
        </div>
    </div>

    <!-- Модални прозорци (непроменени) -->
    <div id="suggestion-form-modal" class="modal">
        <!-- ... съдържание ... -->
    </div>
    <div id="suggestions-list-modal" class="modal">
        <!-- ... съдържание ... -->
    </div>
    
    <!-- Firebase SDKs (непроменени) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // <<< FIREBASE КОНФИГУРАЦИЯ (непроменена) >>>
        const firebaseConfig = {
          // ...
        };

        // Инициализация на Firebase (непроменена)
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const suggestionsRef = db.ref("suggestions");

        document.addEventListener('DOMContentLoaded', function() {
            // --- Логика за предложения (непроменена) ---
            // ...
            
            // =========== НАЧАЛО НА ПРОМЕНИТЕ (JAVASCRIPT) ===========
            const categoryFilter = document.getElementById('category-filter');
            const alphabetFilter = document.getElementById('alphabet-filter');
            const categories = document.querySelectorAll('.category');
            const commandEntries = document.querySelectorAll('.command-entry');
            const commandHeaders = document.querySelectorAll('.command-header');

            let activeCategory = 'all';
            let activeLetter = 'all';

            // Единна функция, която прилага и двата филтъра
            function applyFilters() {
                // Първо филтрираме целите категории
                categories.forEach(category => {
                    const categoryName = category.dataset.category;
                    const isCategoryVisible = (activeCategory === 'all' || activeCategory === categoryName);
                    category.classList.toggle('hidden', !isCategoryVisible);
                });

                // След това филтрираме командите вътре във видимите категории
                commandEntries.forEach(entry => {
                    const letter = entry.dataset.letter.toUpperCase();
                    const isLetterVisible = (activeLetter === 'all' || activeLetter === letter);
                    entry.classList.toggle('hidden', !isLetterVisible);
                });
            }

            // Слушател за филтъра по категории
            categoryFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.category-filter-button');
                if (!button) return;

                // Обновяваме активната категория
                activeCategory = button.dataset.filter;

                // Управляваме визуално кой бутон е активен
                categoryFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');

                // Прилагаме филтрите
                applyFilters();
            });

            // Слушател за филтъра по азбука
            alphabetFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.filter-button');
                if (!button) return;
                
                // Обновяваме активната буква
                activeLetter = button.dataset.filter.toUpperCase();

                // Управляваме визуално кой бутон е активен
                alphabetFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');

                // Прилагаме филтрите
                applyFilters();
            });

            // --- Логика за падащи панели (непроменена) ---
            commandHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const button = this.querySelector('.command-button');
                    const currentPanel = this.nextElementSibling;
                    document.querySelectorAll('.full-description-panel.show').forEach(panel => {
                        if (panel !== currentPanel) {
                            panel.classList.remove('show');
                            panel.previousElementSibling.querySelector('.command-button').classList.remove('active');
                        }
                    });
                    currentPanel.classList.toggle('show');
                    button.classList.toggle('active');
                });
            });
            // =========== КРАЙ НА ПРОМЕНИТЕ (JAVASCRIPT) ===========
        });
    </script>
</body>
</html>
