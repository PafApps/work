<!DOCTYPE html>
<html lang="bg">
<head>
    <!-- Важно: Файлът трябва да бъде запазен с кодиране (Encoding) UTF-8 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пълен списък на AutoLISP команди (86) с Firebase</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; background-color: #fff; padding: 25px 35px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; }
        h1, h3 { text-align: center; color: #1d3557; border-bottom: 2px solid #457b9d; padding-bottom: 10px; margin-bottom: 30px; }
        h3 { border-bottom: none; color: #555; font-weight: normal; margin-top: -20px; }
        h2 { color: #e63946; margin-top: 40px; margin-bottom: 20px; padding-bottom: 8px; border-bottom: 2px solid #f1faee; font-size: 1.6em; background-color: #f8f9fa; padding: 10px; border-radius: 5px; }
        .header-buttons { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; }
        .header-btn { background-color: #e63946; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: background-color 0.3s; }
        .header-btn:hover { background-color: #a8202b; }
        #suggestion-count { background-color: white; color: #e63946; border-radius: 50%; padding: 0px 6px; font-size: 12px; margin-left: 5px; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 8px; position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        #suggestion-form label { display: block; margin-top: 10px; font-weight: bold; }
        #suggestion-form input[type="text"], #suggestion-form textarea { width: 95%; padding: 10px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
        #suggestion-form textarea { height: 100px; resize: vertical; }
        #suggestion-form button { background-color: #457b9d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; font-size: 16px; }
        
        #suggestions-list .suggestion-item { border-bottom: 1px solid #eee; padding: 15px 5px; display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; }
        #suggestions-list .suggestion-details { flex-grow: 1; }
        #suggestions-list .suggester-name { font-weight: bold; color: #1d3557; }
        #suggestions-list .suggestion-text { margin-top: 5px; white-space: pre-wrap; }
        #suggestions-list .status-container { display: flex; flex-direction: column; align-items: flex-end; min-width: 170px; }
        #suggestions-list .actions-container { display: flex; align-items: flex-start; }
        #suggestions-list .status-toggle { border: none; background: none; font-size: 16px; padding: 5px 10px; border-radius: 5px; transition: background-color 0.3s; width: 100%; text-align: left; }
        #suggestions-list .status-toggle.is-pending { background-color: #fce8e6; color: #a50e0e; }
        #suggestions-list .status-toggle.is-done { background-color: #e6f4ea; color: #137333; }
        #suggestions-list .status-toggle.admin-enabled { cursor: pointer; }
        #suggestions-list .status-toggle:not(.admin-enabled) { cursor: not-allowed; opacity: 0.7; }
        .new-command-section { margin-top: 12px; padding-top: 10px; border-top: 1px dashed #ddd; width: 100%; }
        .new-command-section .label { color: #555; font-size: 14px; text-align: left; }
        .new-command-section input[type="text"] { width: 95%; padding: 6px; border-radius: 4px; border: 1px solid #ccc; margin-top: 4px; }
        .new-command-section .command-name { font-weight: bold; font-size: 1.1em; color: #1d3557; margin-top: 4px; text-align: left;}
        .delete-suggestion-btn { background-color: transparent; border: none; color: #e63946; cursor: pointer; font-size: 18px; padding: 5px; margin-left: 10px; opacity: 0.6; transition: opacity 0.3s; }
        .delete-suggestion-btn:hover { opacity: 1; }

        .filters-container { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e1e1e1; }
        #category-filter, #alphabet-filter { display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; }
        .filter-button { background-color: #a8dadc; color: #1d3557; border: none; border-radius: 4px; padding: 5px 10px; font-size: 14px; font-weight: bold; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .category-filter-button { background-color: #a8dadc; color: #1d3557; border: none; border-radius: 5px; padding: 8px 14px; font-size: 15px; font-weight: bold; cursor: pointer; transition: background-color 0.3s, transform 0.2s; }
        .filter-button:hover, .category-filter-button:hover { background-color: #457b9d; color: white; transform: translateY(-2px); }
        .filter-button.active, .category-filter-button.active { background-color: #1d3557; color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .category.hidden, .command-entry.hidden { display: none; }
        .command-entry { margin-bottom: 8px; border-radius: 6px; overflow: hidden; border: 1px solid #e9ecef; transition: box-shadow 0.3s; }
        .command-entry:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .command-header { display: flex; align-items: center; background-color: #f8f9fa; padding: 8px 15px; cursor: pointer; }
        .command-button { background-color: #457b9d; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 15px; transition: background-color 0.3s; text-align: center; font-weight: 500; min-width: 180px; text-transform: uppercase; }
        .command-header:hover .command-button, .command-button.active { background-color: #1d3557; }
        .short-description { margin-left: 20px; font-size: 15px; color: #555; flex-grow: 1; }
        .full-description-panel { max-height: 0; opacity: 0; overflow: hidden; background-color: #f1faee; color: #1d3557; box-sizing: border-box; transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.4s ease-out; padding: 0 15px; border-top: 1px solid #e1e1e1; }
        .full-description-panel.show { max-height: 300px; opacity: 1; padding: 15px; transition: max-height 0.4s ease-in, opacity 0.3s ease-in, padding 0.4s ease-in; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-buttons">
            <button id="add-suggestion-btn" class="header-btn">Предложение</button>
            <button id="view-suggestions-btn" class="header-btn">
                Виж предложенията
                <span id="suggestion-count">0</span>
            </button>
        </div>

        <h1>Интерактивен списък на AutoLISP команди</h1>
        <h3>Намерени общо 86 уникални команди, разпределени в категории</h3>

        <div class="filters-container">
            <div id="category-filter">
                <button class="category-filter-button active" data-filter="all">ВСИЧКИ СЕКЦИИ</button>
                <button class="category-filter-button" data-filter="situation">Ситуация</button>
                <button class="category-filter-button" data-filter="longitudinal-profiles">Надлъжни</button>
                <button class="category-filter-button" data-filter="cross-sections">Напречни</button>
                <button class="category-filter-button" data-filter="blocks">Блокове</button>
                <button class="category-filter-button" data-filter="layouts">Layouts</button>
                <button class="category-filter-button" data-filter="civil">Civil 3D</button>
                <button class="category-filter-button" data-filter="registers">Регистри (Civil)</button>
                <button class="category-filter-button" data-filter="other">Други</button>
            </div>
            <div id="alphabet-filter">
                <button class="filter-button active" data-filter="all">ВСИЧКИ БУКВИ</button>
                <script>document.write(Array.from(Array(26)).map((e, i) => `<button class="filter-button" data-filter="${String.fromCharCode(i + 65)}">${String.fromCharCode(i + 65)}</button>`).join(''));</script>
            </div>
        </div>
        
        <div class="category" data-category="situation">
            <h2>Команди за Ситуация</h2>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">addtoblock</button><span class="short-description">Добавя обекти към блок.</span></div><div class="full-description-panel"><p>Вкарва маркирани обекти в съществуващ, маркиран от вас блок.</p></div></div>
            <div class="command-entry" data-letter="B"><div class="command-header"><button class="command-button">BatchETR</button><span class="short-description">Прави ETRANSMIT на много файлове.</span></div><div class="full-description-panel"><p>Прави ETRANSМIT на избрани файлове с възможни 3 настройки (Batch Etransmit).</p></div></div>
            <div class="command-entry" data-letter="B"><div class="command-header"><button class="command-button">Bind-Detach</button><span class="short-description">Bind-ва или Detach-ва Xref-ове.</span></div><div class="full-description-panel"><p>Вкарва заредените Xref-ове във файла като блокове (Bind), а незаредените ги премахва (Detach).</p></div></div>
            <div class="command-entry" data-letter="C"><div class="command-header"><button class="command-button">calc</button><span class="short-description">Събира/Изважда стойности от текст.</span></div><div class="full-description-panel"><p>Събира/Изважда две числа (TEXT,MTEXT) и поставя резултата в друг TEXT/MTEXT.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">delblocks</button><span class="short-description">Изтрива дефиниции на блокове.</span></div><div class="full-description-panel"><p>Изтрива избран блок или блокове от файла.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">dims</button><span class="short-description">Създава ориентирана дименсия за Ситуация.</span></div><div class="full-description-panel"><p>Създава стил дименсии за Ситуация (ако няма), слага го като текущ и прави ориентирана дименсия (aligned dimension).</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">DIt</button><span class="short-description">Измерва и записва разстояние в текст.</span></div><div class="full-description-panel"><p>Измерва разстоянието между две точки и го записва в избран TEXT или MTEXT.</p></div></div>
            <div class="command-entry" data-letter="E"><div class="command-header"><button class="command-button">ETR</button><span class="short-description">Прави ETRANSMIT на текущия файл.</span></div><div class="full-description-panel"><p>Прави ETRANSМIT на отворения файл с възможни 3 настройки.</p></div></div>
            <div class="command-entry" data-letter="K"><div class="command-header"><button class="command-button">km</button><span class="short-description">Копира текст между различни обекти.</span></div><div class="full-description-panel"><p>Копира текста от txt/mtext/блок/атрибут и го пейства в друг txt/mtext/блок/атрибут.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">label</button><span class="short-description">Поставя надпис по линия.</span></div><div class="full-description-panel"><p>Поставя написан от вас надпис по продължение на Line/Polyline/Curve.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">LoadLineM</button><span class="short-description">Зарежда всички типове линии.</span></div><div class="full-description-panel"><p>Добавя всички стандартни AutoCAD типове линии във файла.</p></div></div>
            <div class="command-entry" data-letter="M"><div class="command-header"><button class="command-button">MTA</button><span class="short-description">MapTrim на всички обекти.</span></div><div class="full-description-panel"><p>Прави MapTrim (трие и изрязва) на всички обекти във файла извън посочена граница (Map Trim All).</p></div></div>
            <div class="command-entry" data-letter="M"><div class="command-header"><button class="command-button">MTB</button><span class="short-description">MapTrim на блокове.</span></div><div class="full-description-panel"><p>Същото като MTA, но работи само за блокове (Map Trim Blocks).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ncut</button><span class="short-description">Изрязва (Cut) обект от блок.</span></div><div class="full-description-panel"><p>Изрязва обект от блок, без да се налага да се влиза в него (Nested Cut).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ndel</button><span class="short-description">Трие обект от блок.</span></div><div class="full-description-panel"><p>Трие обект от блок, без да се налага да се влиза в него (Nested Delete).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">nmove</button><span class="short-description">Премества обект в блок/Xref.</span></div><div class="full-description-panel"><p>Премества обекти в блокове и XREF, без да се налага да влизате в тях. (Внимание: прави SAVE на Xref-а, дори да е отворен!) (Nested Move).</p></div></div>
            <div class="command-entry" data-letter="P"><div class="command-header"><button class="command-button">PJ</button><span class="short-description">Подобрен Polyline Join.</span></div><div class="full-description-panel"><p>Свързва линии/полилинии дори да се застъпват леко или да има малко разстояние между тях (Polyline Join).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qe</button><span class="short-description">Бърза редакция на текст в блокове.</span></div><div class="full-description-panel"><p>Променяте текста на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qec</button><span class="short-description">Бърза смяна на цвят в блокове.</span></div><div class="full-description-panel"><p>Променяте цвета на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit Color).</p></div></div>
            <div class="command-entry" data-letter="S"><div class="command-header"><button class="command-button">slope</button><span class="short-description">Чертае мустаци на откоси.</span></div><div class="full-description-panel"><p>Команда за правене на мустаци на откосите.</p></div></div>
            <div class="command-entry" data-letter="S"><div class="command-header"><button class="command-button">STRELKA</button><span class="short-description">Поставя стрелка за посока на канавка.</span></div><div class="full-description-panel"><p>Добавя стрелка с посока на канавка, като маркирате линията на канавката и я поставяте спрямо нея (и на офсет), където решите.</p></div></div>
            <div class="command-entry" data-letter="T"><div class="command-header"><button class="command-button">TKM</button><span class="short-description">Зарежда типове линии за ТКМ.</span></div><div class="full-description-panel"><p>Добавя всички типови линии свързани с ТКМ.</p></div></div>
            <div class="command-entry" data-letter="V"><div class="command-header"><button class="command-button">vpol / vpoa</button><span class="short-description">Прехвърля очертания на Viewport в Model.</span></div><div class="full-description-panel"><p>Прехвърля очертанията на Viewport в Model-space. С командата <strong>VPOA</strong> го прави за всички Viewports едновременно.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wf</button><span class="short-description">Променя Width Factor на текст.</span></div><div class="full-description-panel"><p>Променя width factor на избран/и текстови обекти.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wfb</button><span class="short-description">Променя Width Factor на текст в блок.</span></div><div class="full-description-panel"><p>Променя width factor на текст, който се намира в блок.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">ww</button><span class="short-description">Отбелязва точки от профил в ситуация.</span></div><div class="full-description-panel"><p>Бързо отбелязване на точки от напречния профил в ситуация, както и нанасяне на кота дъно канавка.</p></div></div>
        </div>

        <div class="category" data-category="longitudinal-profiles">
            <h2>Команди за Надлъжни профили</h2>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">addtoblock</button><span class="short-description">Добавя обекти към блок.</span></div><div class="full-description-panel"><p>Вкарва маркирани обекти в съществуващ, маркиран от вас блок.</p></div></div>
            <div class="command-entry" data-letter="C"><div class="command-header"><button class="command-button">calc</button><span class="short-description">Събира/Изважда стойности от текст.</span></div><div class="full-description-panel"><p>Събира/Изважда две числа (TEXT,MTEXT) и поставя резултата в друг TEXT/MTEXT.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">delblocks</button><span class="short-description">Изтрива дефиниции на блокове.</span></div><div class="full-description-panel"><p>Изтрива избран блок или блокове от файла.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">DIt</button><span class="short-description">Измерва и записва разстояние в текст.</span></div><div class="full-description-panel"><p>Измерва разстоянието между две точки и го записва в избран TEXT или MTEXT.</p></div></div>
            <div class="command-entry" data-letter="K"><div class="command-header"><button class="command-button">km</button><span class="short-description">Копира текст между различни обекти.</span></div><div class="full-description-panel"><p>Копира текста от txt/mtext/блок/атрибут и го пейства в друг txt/mtext/блок/атрибут.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">Ln</button><span class="short-description">Чертае линия със зададен наклон в %.</span></div><div class="full-description-panel"><p>Чертаете и надписвате линия със зададен от вас наклон в %.</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ncut</button><span class="short-description">Изрязва (Cut) обект от блок.</span></div><div class="full-description-panel"><p>Изрязва обект от блок, без да се налага да се влиза в него (Nested Cut).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ndel</button><span class="short-description">Трие обект от блок.</span></div><div class="full-description-panel"><p>Трие обект от блок, без да се налага да се влиза в него (Nested Delete).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">nmove</button><span class="short-description">Премества обект в блок/Xref.</span></div><div class="full-description-panel"><p>Премества обекти в блокове и XREF, без да се налага да влизате в тях. (Внимание: прави SAVE на Xref-а, дори да е отворен!) (Nested Move).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qe</button><span class="short-description">Бърза редакция на текст в блокове.</span></div><div class="full-description-panel"><p>Променяте текста на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qec</button><span class="short-description">Бърза смяна на цвят в блокове.</span></div><div class="full-description-panel"><p>Променяте цвета на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit Color).</p></div></div>
            <div class="command-entry" data-letter="V"><div class="command-header"><button class="command-button">vpol / vpoa</button><span class="short-description">Прехвърля очертания на Viewport в Model.</span></div><div class="full-description-panel"><p>Прехвърля очертанията на Viewport в Model-space. С командата <strong>VPOA</strong> го прави за всички Viewports едновременно.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wf</button><span class="short-description">Променя Width Factor на текст.</span></div><div class="full-description-panel"><p>Променя width factor на избран/и текстови обекти.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wfb</button><span class="short-description">Променя Width Factor на текст в блок.</span></div><div class="full-description-panel"><p>Променя width factor на текст, който се намира в блок.</p></div></div>
        </div>

        <div class="category" data-category="cross-sections">
            <h2>Команди за Напречни профили</h2>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">a3</button><span class="short-description">Изкарване на площи в таблици.</span></div><div class="full-description-panel"><p>Изкарване на оградени площи в напречния профил в таблици.</p></div></div>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">a3a</button><span class="short-description">Изкарване на площи с КМ.</span></div><div class="full-description-panel"><p>Като 'a3', но изкарва всички площи заедно с километража на даден профил наведнъж.</p></div></div>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">a3all</button><span class="short-description">Автоматично попълва таблици с количества.</span></div><div class="full-description-panel"><p>Автоматично попълва таблиците с количества. Използва рамките за Layout-и и взима всичко, което попада в тях.</p></div></div>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">addtoblock</button><span class="short-description">Добавя обекти към блок.</span></div><div class="full-description-panel"><p>Вкарва маркирани обекти в съществуващ, маркиран от вас блок.</p></div></div>
            <div class="command-entry" data-letter="A"><div class="command-header"><button class="command-button">ATTCH</button><span class="short-description">Оправя тагове на атрибути.</span></div><div class="full-description-panel"><p>Оправя таговете на атрибутската таблица за количества, както са описани във файла Layers.csv.</p></div></div>
            <div class="command-entry" data-letter="C"><div class="command-header"><button class="command-button">calc</button><span class="short-description">Събира/Изважда стойности от текст.</span></div><div class="full-description-panel"><p>Събира/Изважда две числа (TEXT,MTEXT) и поставя резултата в друг TEXT/MTEXT.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">d3</button><span class="short-description">Пускане на ординати.</span></div><div class="full-description-panel"><p>Пускане на ординати в напречните профили.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">D3all</button><span class="short-description">Автоматично пуска d3 на 1 профил.</span></div><div class="full-description-panel"><p>Пуска автоматично d3-ки на 1 профил, като се маркира целият прoфил. Слоевете за ОП и ЗОП трябва да са конкретни.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">D3all2</button><span class="short-description">Автоматично пуска d3 на много профили.</span></div><div class="full-description-panel"><p>Пуска автоматично d3-ки на n-брой профили, като се маркират рамките за Layout-и. Слоевете за ОП и ЗОП трябва да са конкретни.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">d3RO</button><span class="short-description">Пуска d3-ки за пътни профили.</span></div><div class="full-description-panel"><p>Пуска d3-ки на пътни напречни профили, както последно са уточнени.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">delblocks</button><span class="short-description">Изтрива дефиниции на блокове.</span></div><div class="full-description-panel"><p>Изтрива избран блок или блокове от файла.</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">dimc</button><span class="short-description">Създава линейна дименсия за профили.</span></div><div class="full-description-panel"><p>Създава стил дименсии за Напречни профили (ако няма), слага го като текущ и прави линейна дименсия (lineal dimension).</p></div></div>
            <div class="command-entry" data-letter="D"><div class="command-header"><button class="command-button">DIt</button><span class="short-description">Измерва и записва разстояние в текст.</span></div><div class="full-description-panel"><p>Измерва разстоянието между две точки и го записва в избран TEXT или MTEXT.</p></div></div>
            <div class="command-entry" data-letter="K"><div class="command-header"><button class="command-button">km</button><span class="short-description">Копира текст между различни обекти.</span></div><div class="full-description-panel"><p>Копира текста от txt/mtext/блок/атрибут и го пейства в друг txt/mtext/блок/атрибут.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">LAQ</button><span class="short-description">Създава слоеве за количества.</span></div><div class="full-description-panel"><p>Създава слоевете за ограждане на количества. Ако искате да добавите нови, направете го във файла Layers.csv в папка TitleBlocks на сървъра.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">Ln</button><span class="short-description">Чертае линия със зададен наклон в %.</span></div><div class="full-description-panel"><p>Чертаете и надписвате линия със зададен от вас наклон в %.</p></div></div>
            <div class="command-entry" data-letter="L"><div class="command-header"><button class="command-button">Lо</button><span class="short-description">Чертае откосна линия (1:n).</span></div><div class="full-description-panel"><p>Чертаете и надписвате откосна линия със зададен от вас наклон - напр. 1:2 (Y:X).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">naklon</button><span class="short-description">Надписва наклон в %.</span></div><div class="full-description-panel"><p>Надписва наклон в проценти.</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ncut</button><span class="short-description">Изрязва (Cut) обект от блок.</span></div><div class="full-description-panel"><p>Изрязва обект от блок, без да се налага да се влиза в него (Nested Cut).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">ndel</button><span class="short-description">Трие обект от блок.</span></div><div class="full-description-panel"><p>Трие обект от блок, без да се налага да се влиза в него (Nested Delete).</p></div></div>
            <div class="command-entry" data-letter="N"><div class="command-header"><button class="command-button">nmove</button><span class="short-description">Премества обект в блок/Xref.</span></div><div class="full-description-panel"><p>Премества обекти в блокове и XREF, без да се налага да влизате в тях. (Внимание: прави SAVE на Xref-а, дори да е отворен!) (Nested Move).</p></div></div>
            <div class="command-entry" data-letter="O"><div class="command-header"><button class="command-button">otkos</button><span class="short-description">Надписва наклон на откос 1:n.</span></div><div class="full-description-panel"><p>Надписва наклона на откоса в съотношение 1:n.</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">QB</button><span class="short-description">Ограждане на количества с Boundary.</span></div><div class="full-description-panel"><p>Ограждане на всички количества едно по едно, като изолира нужните слоеве, маркират се обектите, между които да се пусне граница, и се огражда с Boundary. По-надеждно е от QH.</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">QBZ</button><span class="short-description">Автоматично огражда баласт и ЗП.</span></div><div class="full-description-panel"><p>Автоматично огражда площите на нов баласт и защитен пласт. Може да дава грешки при не-добре затворени контури.</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qe</button><span class="short-description">Бърза редакция на текст в блокове.</span></div><div class="full-description-panel"><p>Променяте текста на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">qec</button><span class="short-description">Бърза смяна на цвят в блокове.</span></div><div class="full-description-panel"><p>Променяте цвета на TEXT, MTEXT и атрибути в блокове без да влизате в тях (Quick Edit Color).</p></div></div>
            <div class="command-entry" data-letter="Q"><div class="command-header"><button class="command-button">QH (QALL)</button><span class="short-description">Ограждане на количества с Hatch.</span></div><div class="full-description-panel"><p>Ограждане на всички количества едно по едно, като изолира нужните слоеве и огражда като с Hatch (ако контурът не е затворен или има блокове, понякога дава грешки).</p></div></div>
            <div class="command-entry" data-letter="R"><div class="command-header"><button class="command-button">regATT</button><span class="short-description">Регистър от атрибути за КСС.</span></div><div class="full-description-panel"><p>Изкарва в Excel-ска таблица стойностите от таблиците с количества в готов вид за пействане в подробната количествена сметка.</p></div></div>
            <div class="command-entry" data-letter="R"><div class="command-header"><button class="command-button">regATT2</button><span class="short-description">Разширен регистър от атрибути.</span></div><div class="full-description-panel"><p>Изкарва в Excel-ска таблица стойностите от таблиците с количества, както и сметките, които по принцип се правят в подробната ведомост.</p></div></div>
            <div class="command-entry" data-letter="R"><div class="command-header"><button class="command-button">regAttAll</button><span class="short-description">Регистър атрибути + координати.</span></div><div class="full-description-panel"><p>Изкарва в Excel-ска таблица стойностите от таблиците с количества + X и Y координати на блока.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wf</button><span class="short-description">Променя Width Factor на текст.</span></div><div class="full-description-panel"><p>Променя width factor на избран/и текстови обекти.</p></div></div>
            <div class="command-entry" data-letter="W"><div class="command-header"><button class="command-button">wfb</button><span class="short-description">Променя Width Factor на текст в блок.</span></div><div class="full-description-panel"><p>Променя width factor на текст, който се намира в блок.</p></div></div>
        </div>
        
        <div class="category" data-category="blocks">
            <h2>Команди за Блокове</h2>
            <!-- ... -->
        </div>
        
        <div class="category" data-category="layouts">
            <h2>Команди за Layouts</h2>
            <!-- ... -->
        </div>

        <div class="category" data-category="other">
            <h2>Други команди</h2>
            <!-- ... -->
        </div>

        <div class="category" data-category="civil">
            <h2>Команди за Civil 3D</h2>
            <!-- ... -->
        </div>
        
        <div class="category" data-category="registers">
            <h2>Команди за Регистри (Civil 3D)</h2>
            <!-- ... -->
        </div>
    </div>

    <!-- Модални прозорци за предложения -->
    <div id="suggestion-form-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Направи предложение</h2>
            <form id="suggestion-form">
                <label for="suggester-name">Име:</label>
                <input type="text" id="suggester-name" required>
                <label for="suggestion-text">Предложение:</label>
                <textarea id="suggestion-text" required></textarea>
                <button type="submit">Изпрати</button>
            </form>
        </div>
    </div>
    <div id="suggestions-list-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Списък с предложения</h2>
            <div id="suggestions-list"></div>
        </div>
    </div>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // <<< ВАШАТА FIREBASE КОНФИГУРАЦИЯ ТУК >>>
        const firebaseConfig = {
          apiKey: "AIzaSyACB9shT_VTr3PGW_1nFjJCGAgwSI55Omw",
          authDomain: "clickcount-a6e46.firebaseapp.com",
          databaseURL: "https://clickcount-a6e46-default-rtdb.firebaseio.com",
          projectId: "clickcount-a6e46",
          storageBucket: "clickcount-a6e46.appspot.com",
          messagingSenderId: "53304151952",
          appId: "1:53304151952:web:ed0c365ace6b1232842d15",
          measurementId: "G-5S028177MG"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const suggestionsRef = db.ref("suggestions");

        document.addEventListener('DOMContentLoaded', function() {
            const isAdmin = () => new URLSearchParams(window.location.search).get('admin') === 'true';
            const adminMode = isAdmin();

            const addSuggestionBtn = document.getElementById('add-suggestion-btn');
            const viewSuggestionsBtn = document.getElementById('view-suggestions-btn');
            const suggestionFormModal = document.getElementById('suggestion-form-modal');
            const suggestionsListModal = document.getElementById('suggestions-list-modal');
            const suggestionForm = document.getElementById('suggestion-form');
            const suggestionsListDiv = document.getElementById('suggestions-list');
            const suggestionCountSpan = document.getElementById('suggestion-count');
            const closeButtons = document.querySelectorAll('.close-button');
            
            const renderSuggestions = (snapshot) => {
                suggestionsListDiv.innerHTML = '';
                suggestionCountSpan.textContent = snapshot.numChildren();
                if (!snapshot.exists()) {
                    suggestionsListDiv.innerHTML = '<p>Все още няма подадени предложения.</p>';
                    return;
                }
                snapshot.forEach(childSnapshot => {
                    const key = childSnapshot.key;
                    const suggestion = childSnapshot.val();
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    
                    const detailsDiv = document.createElement('div');
                    detailsDiv.className = 'suggestion-details';
                    detailsDiv.innerHTML = `
                        <p class="suggester-name">${suggestion.name || 'Анонимен'}:</p>
                        <p class="suggestion-text">${suggestion.text}</p>`;
                    item.appendChild(detailsDiv);

                    const rightColumn = document.createElement('div');
                    rightColumn.className = 'actions-container';

                    const statusContainer = document.createElement('div');
                    statusContainer.className = 'status-container';

                    const statusBtn = document.createElement('button');
                    statusBtn.className = 'status-toggle';
                    statusBtn.dataset.id = key;

                    if (suggestion.status === 'done') {
                        statusBtn.textContent = '✅ Направено';
                        statusBtn.classList.add('is-done');

                        const newCommandDiv = document.createElement('div');
                        newCommandDiv.className = 'new-command-section';
                        newCommandDiv.innerHTML = `<p class="label">Нова команда:</p>`;
                        
                        if (adminMode) {
                            const commandInput = document.createElement('input');
                            commandInput.type = 'text';
                            commandInput.value = suggestion.newCommandName || '';
                            commandInput.placeholder = 'Въведете името';
                            commandInput.dataset.id = key;
                            newCommandDiv.appendChild(commandInput);
                        } else {
                            const commandDisplay = document.createElement('p');
                            commandDisplay.className = 'command-name';
                            commandDisplay.textContent = suggestion.newCommandName || '(няма зададена)';
                            newCommandDiv.appendChild(commandDisplay);
                        }
                        statusContainer.appendChild(statusBtn);
                        statusContainer.appendChild(newCommandDiv);
                    } else {
                        statusBtn.textContent = '❌ Не е направено';
                        statusBtn.classList.add('is-pending');
                        statusContainer.appendChild(statusBtn);
                    }

                    if (adminMode) statusBtn.classList.add('admin-enabled');
                    
                    rightColumn.appendChild(statusContainer);
                    
                    if(adminMode){
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete-suggestion-btn';
                        deleteBtn.innerHTML = ''; 
                        deleteBtn.title = 'Изтрий предложението';
                        deleteBtn.dataset.id = key;
                        rightColumn.appendChild(deleteBtn);
                    }
                    
                    item.appendChild(rightColumn);
                    suggestionsListDiv.appendChild(item);
                });
            };
            
            suggestionsRef.orderByChild("timestamp").on("value", renderSuggestions);

            addSuggestionBtn.addEventListener('click', () => { suggestionFormModal.style.display = 'block'; });
            viewSuggestionsBtn.addEventListener('click', () => { suggestionsListModal.style.display = 'block'; });
            closeButtons.forEach(btn => btn.addEventListener('click', () => {
                suggestionFormModal.style.display = 'none';
                suggestionsListModal.style.display = 'none';
            }));
            window.addEventListener('click', (event) => {
                if (event.target == suggestionFormModal || event.target == suggestionsListModal) {
                    suggestionFormModal.style.display = 'none';
                    suggestionsListModal.style.display = 'none';
                }
            });

            suggestionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('suggester-name').value;
                const text = document.getElementById('suggestion-text').value;
                if (!text.trim()) { alert('Моля, въведете текст на предложението.'); return; }
                
                suggestionsRef.push({
                    name: name.trim() || 'Анонимен',
                    text: text.trim(),
                    status: 'pending',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    suggestionForm.reset();
                    suggestionFormModal.style.display = 'none';
                    alert('Благодарим за предложението!');
                }).catch((error) => console.error("Грешка при запис: ", error));
            });
            
            suggestionsListDiv.addEventListener('click', (e) => {
                if (e.target.classList.contains('status-toggle') && adminMode) {
                    const id = e.target.dataset.id;
                    const docRef = suggestionsRef.child(id);
                    docRef.get().then((snapshot) => {
                        if (snapshot.exists()) {
                            const newStatus = snapshot.val().status === 'pending' ? 'done' : 'pending';
                            docRef.update({ status: newStatus });
                        }
                    });
                }
                if (e.target.classList.contains('delete-suggestion-btn') && adminMode) {
                    const id = e.target.dataset.id;
                    if(confirm('Наистина ли искате да изтриете това предложение? Действието е необратимо!')) {
                        suggestionsRef.child(id).remove()
                           .catch(error => console.error("Грешка при изтриване: ", error));
                    }
                }
            });
            
            suggestionsListDiv.addEventListener('blur', (e) => {
                if (e.target.tagName === 'INPUT' && e.target.closest('.new-command-section') && adminMode) {
                    const id = e.target.dataset.id;
                    const newName = e.target.value.trim();
                    suggestionsRef.child(id).update({ newCommandName: newName })
                        .catch(error => console.error("Грешка при запис на името на командата:", error));
                }
            }, true);

            // --- ЛОГИКА ЗА ФИЛТРИ И ПАДАЩИ ПАНЕЛИ ---
            const categoryFilter = document.getElementById('category-filter');
            const alphabetFilter = document.getElementById('alphabet-filter');
            const categories = document.querySelectorAll('.category');
            const commandEntries = document.querySelectorAll('.command-entry');
            const commandHeaders = document.querySelectorAll('.command-header');

            let activeCategory = 'all';
            let activeLetter = 'all'; 

            function applyFilters() {
                commandEntries.forEach(entry => {
                    const category = entry.closest('.category').dataset.category;
                    const letter = entry.dataset.letter.toUpperCase();
                    
                    const isCategoryVisible = (activeCategory === 'all' || activeCategory === category);
                    const isLetterVisible = (activeLetter.toLowerCase() === 'all' || activeLetter === letter);

                    entry.classList.toggle('hidden', !(isCategoryVisible && isLetterVisible));
                });

                categories.forEach(category => {
                    const visibleEntries = category.querySelectorAll('.command-entry:not(.hidden)');
                    category.classList.toggle('hidden', visibleEntries.length === 0);
                });
            }

            categoryFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.category-filter-button');
                if (!button) return;

                activeCategory = button.dataset.filter;
                categoryFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                applyFilters();
            });

            alphabetFilter.addEventListener('click', function(e) {
                const button = e.target.closest('.filter-button');
                if (!button) return;
                
                activeLetter = button.dataset.filter.toUpperCase();
                alphabetFilter.querySelector('.active').classList.remove('active');
                button.classList.add('active');
                applyFilters();
            });

            commandHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const button = this.querySelector('.command-button');
                    const currentPanel = this.nextElementSibling;
                    document.querySelectorAll('.full-description-panel.show').forEach(panel => {
                        if (panel !== currentPanel) {
                            panel.classList.remove('show');
                            panel.previousElementSibling.querySelector('.command-button').classList.remove('active');
                        }
                    });
                    currentPanel.classList.toggle('show');
                    button.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>
